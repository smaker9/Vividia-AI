<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vividia AI Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #0b1120; --card: #1e293b; --accent: #4f46e5; --text: #f8fafc; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        .main-content { flex: 1; display: flex; flex-direction: column; width: 100%; position: relative; }
        
        /* تنسيق الدردشة الأفقية الواسعة مثل جيميناي */
        #chat-container { flex: 1; overflow-y: auto; padding: 40px 10%; display: flex; flex-direction: column; gap: 30px; }
        
        .message { width: 100%; display: flex; flex-direction: column; align-items: flex-start; animation: fadeIn 0.4s ease; }
        .user-message { align-items: flex-end; }
        
        .bubble { max-width: 85%; padding: 15px 25px; border-radius: 15px; line-height: 1.8; font-size: 1.1rem; white-space: pre-wrap; word-break: break-word; }
        .user-bubble { background: var(--accent); color: white; border-bottom-left-radius: 2px; }
        .ai-bubble { background: transparent; border: none; padding-right: 0; text-align: right; width: 100%; }

        /* فصل الأيقونات تماماً لمنع التشابك */
        .controls { display: flex; gap: 15px; margin-top: 10px; color: #94a3b8; }
        .controls i { cursor: pointer; transition: 0.3s; padding: 5px; }
        .controls i:hover { color: #8ab4f8; }

        /* مربع الإدخال الذكي مع الأيقونات الحقيقية */
        .input-container { padding: 20px 10%; background: var(--bg); }
        .input-box { background: #1e293b; border-radius: 30px; padding: 10px 20px; display: flex; align-items: center; gap: 15px; border: 1px solid #334155; }
        .input-box input { flex: 1; background: none; border: none; color: white; font-size: 1rem; outline: none; }
        
        .icon-btn { color: #94a3b8; cursor: pointer; font-size: 1.2rem; transition: 0.2s; }
        .icon-btn:hover { color: #8ab4f8; }
        
        /* إخفاء مدخلات الملفات الأصلية */
        #file-input, #image-input { display: none; }
    </style>
</head>
<body>

    <div class="main-content">
        <div id="chat-container">
            <div class="message ai-message">
                <div class="ai-bubble" id="welcome-text">مرحباً بكِ في Vividia. أنا جاهزة لمساعدتكِ الآن بصوت احترافي وواجهة مطورة.</div>
                <div class="controls">
                    <i class="fas fa-volume-up" onclick="speak(document.getElementById('welcome-text').innerText)"></i>
                    <i class="fas fa-copy" onclick="alert('تم النسخ')"></i>
                </div>
            </div>
        </div>

        <div class="input-container">
            <div class="input-box">
                <i class="fas fa-plus-circle icon-btn" onclick="document.getElementById('file-input').click()"></i>
                <i class="fas fa-image icon-btn" onclick="document.getElementById('image-input').click()"></i>
                
                <input type="file" id="file-input" onchange="alert('تم اختيار ملف: ' + this.files[0].name)">
                <input type="file" id="image-input" accept="image/*" onchange="alert('تم اختيار صورة من المعرض: ' + this.files[0].name)">
                
                <input type="text" id="user-input" placeholder="اسألي فيفيديا..." onkeypress="if(event.key === 'Enter') sendMessage()">
                <i class="fas fa-paper-plane icon-btn" style="color:#4f46e5" onclick="sendMessage()"></i>
            </div>
        </div>
    </div>

    <script>
        function speak(text) {
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(text);
            msg.lang = 'ar-SA';
            msg.rate = 0.9; 
            msg.pitch = 1.0;
            window.speechSynthesis.speak(msg);
        }

        async function sendMessage() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            if (!message) return;

            appendMsg('user', message);
            input.value = '';
            
            // محاكاة استجابة فيفيديا الاحترافية
            const aiBody = appendMsg('ai', '... جاري التفكير');
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: message })
                });
                const data = await response.json();
                aiBody.innerText = data.response;
                speak(data.response); // نطق الرد تلقائياً كجيميناي
            } catch (e) { aiBody.innerText = "خطأ في الاتصال."; }
        }

        function appendMsg(role, text) {
            const container = document.getElementById('chat-container');
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${role}-message`;
            
            const bubble = document.createElement('div');
            bubble.className = `bubble ${role}-bubble`;
            bubble.innerText = text;
            
            msgDiv.appendChild(bubble);
            
            if(role === 'ai') {
                const controls = document.createElement('div');
                controls.className = 'controls';
                controls.innerHTML = `<i class="fas fa-volume-up" onclick="speak('${text.replace(/'/g, "\\'")}')"></i><i class="fas fa-redo"></i>`;
                msgDiv.appendChild(controls);
            }
            
            container.appendChild(msgDiv);
            container.scrollTop = container.scrollHeight;
            return bubble;
        }
    </script>
</body>
</html>


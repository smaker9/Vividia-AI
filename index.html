<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Vividia Pro - Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„ØµÙˆØªÙŠ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        :root {
            --primary: #8B5CF6;
            --primary-dark: #7C3AED;
            --secondary: #F59E0B;
            --success: #10B981;
            --danger: #EF4444;
            --dark: #0F172A;
            --darker: #020617;
            --light: #F8FAFC;
            --gray: #94A3B8;
        }

        body {
            background: var(--darker);
            color: var(--light);
            min-height: 100vh;
            padding: 10px;
        }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ù„Ù„Ø¬ÙˆØ§Ù„ */
        .mobile-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--dark);
            border-top: 1px solid #334155;
            display: flex;
            justify-content: space-around;
            padding: 10px;
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--gray);
            font-size: 12px;
            cursor: pointer;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-item i {
            font-size: 24px;
            margin-bottom: 4px;
        }

        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .user-info {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .plan-badge {
            background: var(--secondary);
            color: var(--dark);
            padding: 5px 15px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 14px;
        }

        .credits {
            background: var(--success);
            color: white;
            padding: 5px 15px;
            border-radius: 50px;
            font-weight: bold;
        }

        /* Ø§Ù„Ø£Ù‚Ø³Ø§Ù… */
        .section {
            display: none;
            margin-bottom: 80px;
        }

        .section.active {
            display: block;
        }

        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø£Ø¯ÙˆØ§Øª */
        .tools-grid {
            display: grid;
            gap: 15px;
            margin-bottom: 20px;
        }

        .tool-card {
            background: var(--dark);
            border: 1px solid #334155;
            border-radius: 20px;
            padding: 20px;
        }

        .tool-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .tool-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .tool-title {
            font-size: 18px;
            font-weight: bold;
        }

        .tool-input {
            width: 100%;
            background: var(--darker);
            border: 1px solid #334155;
            border-radius: 15px;
            padding: 15px;
            color: white;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .tool-select {
            width: 100%;
            background: var(--darker);
            border: 1px solid #334155;
            border-radius: 15px;
            padding: 15px;
            color: white;
            margin-bottom: 15px;
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 15px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-secondary {
            background: var(--secondary);
            color: var(--dark);
        }

        .audio-player {
            margin-top: 15px;
            padding: 15px;
            background: var(--darker);
            border-radius: 15px;
            display: none;
        }

        audio {
            width: 100%;
        }

        /* Ø®Ø·Ø· Ø§Ù„Ø£Ø³Ø¹Ø§Ø± */
        .plans-grid {
            display: grid;
            gap: 15px;
            padding: 10px;
        }

        .plan-card {
            background: var(--dark);
            border: 1px solid #334155;
            border-radius: 20px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .plan-card.popular::before {
            content: "Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹";
            position: absolute;
            top: 10px;
            right: -30px;
            background: var(--secondary);
            color: var(--dark);
            padding: 5px 30px;
            transform: rotate(45deg);
            font-size: 12px;
            font-weight: bold;
        }

        .plan-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .plan-price {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .plan-price small {
            font-size: 14px;
            color: var(--gray);
        }

        .plan-features {
            list-style: none;
            margin-bottom: 20px;
        }

        .plan-features li {
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .plan-features li::before {
            content: "âœ“";
            color: var(--success);
            font-weight: bold;
        }

        .plan-features li.disabled {
            color: var(--gray);
        }

        .plan-features li.disabled::before {
            content: "âœ—";
            color: var(--danger);
        }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„ØºØ§Øª */
        .lang-menu {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 1001;
            background: var(--dark);
            border: 1px solid #334155;
            border-radius: 50px;
            padding: 5px;
            display: flex;
            gap: 5px;
        }

        .lang-btn {
            padding: 8px 12px;
            border: none;
            background: transparent;
            color: var(--gray);
            border-radius: 50px;
            cursor: pointer;
            font-size: 14px;
        }

        .lang-btn.active {
            background: var(--primary);
            color: white;
        }

        /* Ø³Ø¬Ù„ Ø§Ù„Ø¥Ù†ØªØ§Ø¬ */
        .history-list {
            display: grid;
            gap: 10px;
            padding: 10px;
        }

        .history-item {
            background: var(--dark);
            border: 1px solid #334155;
            border-radius: 15px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-info h4 {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .history-info p {
            font-size: 12px;
            color: var(--gray);
        }

        .play-btn {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
        }

        /* ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        .auth-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--darker);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            z-index: 2000;
        }

        .auth-box {
            background: var(--dark);
            border: 1px solid #334155;
            border-radius: 30px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
        }

        .auth-box h2 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary);
        }

        .auth-input {
            width: 100%;
            background: var(--darker);
            border: 1px solid #334155;
            border-radius: 15px;
            padding: 15px;
            color: white;
            margin-bottom: 15px;
        }

        .auth-buttons {
            display: grid;
            gap: 10px;
        }
    </style>
</head>
<body>
    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„ØºØ§Øª -->
    <div class="lang-menu">
        <button class="lang-btn active" onclick="changeLang('ar')">ğŸ‡¸ğŸ‡ª Ø¹Ø±Ø¨ÙŠ</button>
        <button class="lang-btn" onclick="changeLang('en')">ğŸ‡¬ğŸ‡§ EN</button>
        <button class="lang-btn" onclick="changeLang('fr')">ğŸ‡«ğŸ‡· FR</button>
    </div>

    <!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            <h2>ğŸ¬ Vividia Pro</h2>
            <input type="email" id="emailInput" class="auth-input" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" value="user@example.com">
            <div class="auth-buttons">
                <button class="btn btn-primary" onclick="login()">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
                <button class="btn btn-secondary" onclick="signup()">Ø§Ø´ØªØ±Ø§Ùƒ Ø¬Ø¯ÙŠØ¯</button>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„) -->
    <div id="mainContent" style="display: none;">
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <div class="header">
            <h1>ğŸ¬ Vividia Pro</h1>
            <div class="user-info" id="userInfo">
                <span class="plan-badge" id="planName">Ù…Ø¬Ø§Ù†ÙŠ</span>
                <span class="credits" id="creditsAmount">100</span>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø£Ø¯ÙˆØ§Øª -->
        <div class="section active" id="toolsSection">
            <div class="tools-grid">
                <!-- Ø£Ø¯Ø§Ø© Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ØµÙˆØª -->
                <div class="tool-card">
                    <div class="tool-header">
                        <div class="tool-icon">ğŸ™ï¸</div>
                        <div class="tool-title">Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ ØµÙˆØª</div>
                    </div>
                    <textarea id="ttsText" class="tool-input" rows="3" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ù‡Ù†Ø§..."></textarea>
                    <select id="ttsVoice" class="tool-select">
                        <option value="21m00Tcm4TlvDq8ikWAM">ØµÙˆØª Ø¹Ø±Ø¨ÙŠ 1</option>
                        <option value="AZnzlk1XvdvUeBnXmlld">ØµÙˆØª Ø¹Ø±Ø¨ÙŠ 2</option>
                        <option value="EXAVITQu4vr4xnSDxMaL">ØµÙˆØª Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ</option>
                    </select>
                    <button class="btn btn-primary" onclick="generateTTS()">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØª</button>
                    <div class="audio-player" id="ttsPlayer">
                        <audio id="ttsAudio" controls></audio>
                    </div>
                </div>

                <!-- Ø£Ø¯Ø§Ø© Ø§Ù„Ø¯Ø¨Ù„Ø¬Ø© -->
                <div class="tool-card">
                    <div class="tool-header">
                        <div class="tool-icon">ğŸŒ</div>
                        <div class="tool-title">Ø¯Ø¨Ù„Ø¬Ø© ÙÙŠØ¯ÙŠÙˆ</div>
                    </div>
                    <input type="url" id="videoUrl" class="tool-input" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ">
                    <select id="targetLang" class="tool-select">
                        <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                        <option value="en">Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option>
                        <option value="fr">Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©</option>
                    </select>
                    <button class="btn btn-secondary" onclick="startDubbing()">Ø¨Ø¯Ø¡ Ø§Ù„Ø¯Ø¨Ù„Ø¬Ø©</button>
                    <div class="audio-player" id="dubPlayer">
                        <audio id="dubAudio" controls></audio>
                    </div>
                </div>

                <!-- Ø£Ø¯Ø§Ø© Ø§Ù„Ù…Ø¤Ø«Ø±Ø§Øª -->
                <div class="tool-card">
                    <div class="tool-header">
                        <div class="tool-icon">ğŸ”Š</div>
                        <div class="tool-title">Ù…Ø¤Ø«Ø±Ø§Øª ØµÙˆØªÙŠØ©</div>
                    </div>
                    <input type="text" id="sfxPrompt" class="tool-input" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ø¤Ø«Ø±">
                    <input type="number" id="sfxDuration" class="tool-input" value="5" min="1" max="30">
                    <button class="btn btn-primary" onclick="generateSFX()">ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø¤Ø«Ø±</button>
                    <div class="audio-player" id="sfxPlayer">
                        <audio id="sfxAudio" controls></audio>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø®Ø·Ø· Ø§Ù„Ø£Ø³Ø¹Ø§Ø± -->
        <div class="section" id="plansSection">
            <div class="plans-grid">
                <!-- Ù…Ø¬Ø§Ù†ÙŠ -->
                <div class="plan-card">
                    <div class="plan-name">Ù…Ø¬Ø§Ù†ÙŠ</div>
                    <div class="plan-price">$0 <small>/Ø´Ù‡Ø±</small></div>
                    <ul class="plan-features">
                        <li>100 Ø¯Ù‚ÙŠÙ‚Ø© ØµÙˆØª</li>
                        <li>5 Ù…Ø´Ø§Ø±ÙŠØ¹</li>
                        <li>Ø¬ÙˆØ¯Ø© Ø¹Ø§Ø¯ÙŠØ©</li>
                        <li class="disabled">Ù„Ø§ Ø¯Ø¨Ù„Ø¬Ø©</li>
                        <li class="disabled">Ù„Ø§ Ù…Ø¤Ø«Ø±Ø§Øª</li>
                    </ul>
                    <button class="btn btn-primary" onclick="selectPlan('free')">Ù…Ø´ØªØ±Ùƒ Ø­Ø§Ù„ÙŠØ§Ù‹</button>
                </div>

                <!-- Ø§Ø­ØªØ±Ø§ÙÙŠ -->
                <div class="plan-card popular">
                    <div class="plan-name">Ø§Ø­ØªØ±Ø§ÙÙŠ</div>
                    <div class="plan-price">$19.99 <small>/Ø´Ù‡Ø±</small></div>
                    <ul class="plan-features">
                        <li>1000 Ø¯Ù‚ÙŠÙ‚Ø© ØµÙˆØª</li>
                        <li>50 Ù…Ø´Ø±ÙˆØ¹</li>
                        <li>Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©</li>
                        <li>Ø¯Ø¨Ù„Ø¬Ø© ÙÙŠØ¯ÙŠÙˆ</li>
                        <li>Ù…Ø¤Ø«Ø±Ø§Øª Ù…Ø®ØµØµØ©</li>
                    </ul>
                    <button class="btn btn-secondary" onclick="payWithCrypto('pro')">Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù€ $19.99</button>
                </div>

                <!-- ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯ -->
                <div class="plan-card">
                    <div class="plan-name">ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯</div>
                    <div class="plan-price">$49.99 <small>/Ø´Ù‡Ø±</small></div>
                    <ul class="plan-features">
                        <li>ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯</li>
                        <li>Ù…Ø´Ø§Ø±ÙŠØ¹ ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©</li>
                        <li>Ø¬ÙˆØ¯Ø© lossless</li>
                        <li>Ø¯Ø¨Ù„Ø¬Ø© ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯Ø©</li>
                        <li>API Ù…Ø®ØµØµ</li>
                    </ul>
                    <button class="btn btn-primary" onclick="payWithCrypto('business')">Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù€ $49.99</button>
                </div>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø³Ø¬Ù„ -->
        <div class="section" id="historySection">
            <div class="history-list" id="historyList">
                <!-- ÙŠØªÙ… Ø§Ù„ØªØ¹Ø¨Ø¦Ø© Ø¹Ø¨Ø± JavaScript -->
            </div>
        </div>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ -->
        <div class="mobile-nav">
            <div class="nav-item active" onclick="showSection('tools')">
                <i>ğŸ› ï¸</i>
                <span>Ø§Ù„Ø£Ø¯ÙˆØ§Øª</span>
            </div>
            <div class="nav-item" onclick="showSection('plans')">
                <i>ğŸ’</i>
                <span>Ø§Ù„Ø®Ø·Ø·</span>
            </div>
            <div class="nav-item" onclick="showSection('history')">
                <i>ğŸ“‹</i>
                <span>Ø§Ù„Ø³Ø¬Ù„</span>
            </div>
        </div>
    </div>

    <script>
        // Ù…ÙØ§ØªÙŠØ­ API Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
        const ELEVENLABS_KEY = "sk_9e048006fa8c6ebe0068240531808bba33c809c6f43313fe";
        const CRYPTOMUS_KEY = "6Va2ikdcfMbYwog2wJf6thH21iq0fbI9FSLXOefkbFg7pNgRy5WA8ijFqxnBjCc5IF3anDhDzdM5DaqLKN54KUngfpdj5RqBbJ5AG1balI8KeULyrEXallo7qqx0oH57";
        
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        let currentUser = {
            email: '',
            plan: 'free',
            credits: 100,
            history: []
        };

        // Ø§Ù„ØªØ±Ø¬Ù…Ø§Øª
        const translations = {
            ar: {
                free: 'Ù…Ø¬Ø§Ù†ÙŠ',
                pro: 'Ø§Ø­ØªØ±Ø§ÙÙŠ',
                business: 'ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯',
                subscribe: 'Ø§Ø´ØªØ±Ø§Ùƒ'
            },
            en: {
                free: 'Free',
                pro: 'Pro',
                business: 'Unlimited',
                subscribe: 'Subscribe'
            },
            fr: {
                free: 'Gratuit',
                pro: 'Pro',
                business: 'IllimitÃ©',
                subscribe: 'S\'abonner'
            }
        };

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        let isLoggedIn = false;

        function login() {
            const email = document.getElementById('emailInput').value;
            if (email) {
                currentUser.email = email;
                document.getElementById('authContainer').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                isLoggedIn = true;
                loadUserData();
            }
        }

        function signup() {
            const email = document.getElementById('emailInput').value;
            if (email) {
                // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
                currentUser = {
                    email: email,
                    plan: 'free',
                    credits: 100,
                    history: []
                };
                document.getElementById('authContainer').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                isLoggedIn = true;
                saveUserData();
            }
        }

        // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function saveUserData() {
            localStorage.setItem('vividia_user', JSON.stringify(currentUser));
            updateUI();
        }

        function loadUserData() {
            const saved = localStorage.getItem('vividia_user');
            if (saved) {
                currentUser = JSON.parse(saved);
            }
            updateUI();
        }

        function updateUI() {
            document.getElementById('planName').textContent = 
                translations.ar[currentUser.plan] || currentUser.plan;
            document.getElementById('creditsAmount').textContent = currentUser.credits;
            loadHistory();
        }

        // Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            if (section === 'tools') {
                document.getElementById('toolsSection').classList.add('active');
                document.querySelectorAll('.nav-item')[0].classList.add('active');
            } else if (section === 'plans') {
                document.getElementById('plansSection').classList.add('active');
                document.querySelectorAll('.nav-item')[1].classList.add('active');
            } else if (section === 'history') {
                document.getElementById('historySection').classList.add('active');
                document.querySelectorAll('.nav-item')[2].classList.add('active');
            }
        }

        // ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©
        function changeLang(lang) {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.includes(lang === 'ar' ? 'Ø¹Ø±Ø¨ÙŠ' : lang.toUpperCase())) {
                    btn.classList.add('active');
                }
            });
            
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            document.documentElement.lang = lang;
            localStorage.setItem('lang', lang);
        }

        // Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ© Ø¹Ø¨Ø± Cryptomus
        async function payWithCrypto(plan) {
            const prices = {
                pro: 19.99,
                business: 49.99
            };

            try {
                // Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¯ÙØ¹ Ø¹Ø¨Ø± Cryptomus
                const paymentData = {
                    amount: prices[plan].toString(),
                    currency: 'USD',
                    order_id: 'order_' + Date.now(),
                    url_return: window.location.href,
                    url_success: window.location.href,
                    url_callback: 'https://your-server.com/cryptomus-callback',
                    is_payment_multiple: false,
                    lifetime: 3600,
                    to_currency: 'USDT',
                    subtract: 0
                };

                // ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨
                const sign = await generateSignature(paymentData);
                
                // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø¯ÙØ¹
                const response = await fetch('https://api.cryptomus.com/v1/payment', {
                    method: 'POST',
                    headers: {
                        'merchant': CRYPTOMUS_KEY,
                        'sign': sign,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(paymentData)
                });

                const result = await response.json();
                
                if (result.state === 0 && result.result) {
                    // ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹
                    window.location.href = result.result.url;
                } else {
                    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø§Ù„Ø¯ÙØ¹');
                }
            } catch (error) {
                console.error('Payment error:', error);
                alert('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯ÙØ¹');
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ ØªÙˆÙ‚ÙŠØ¹ Ù„Ø·Ù„Ø¨Ø§Øª Cryptomus
        async function generateSignature(data) {
            const jsonString = JSON.stringify(data);
            const encoder = new TextEncoder();
            const dataBytes = encoder.encode(jsonString);
            const keyBytes = encoder.encode(CRYPTOMUS_KEY);
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… HMAC-SHA256
            const cryptoKey = await crypto.subtle.importKey(
                'raw', keyBytes, { name: 'HMAC', hash: 'SHA-256' }, false, ['sign']
            );
            
            const signature = await crypto.subtle.sign('HMAC', cryptoKey, dataBytes);
            return btoa(String.fromCharCode(...new Uint8Array(signature)));
        }

        // ØªÙˆÙ„ÙŠØ¯ ØµÙˆØª Ø­Ù‚ÙŠÙ‚ÙŠ
        async function generateTTS() {
            if (!isLoggedIn) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }

            if (currentUser.credits < 10) {
                alert('Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ. Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ±Ù‚ÙŠØ© Ø®Ø·ØªÙƒ');
                showSection('plans');
                return;
            }

            const text = document.getElementById('ttsText').value;
            const voiceId = document.getElementById('ttsVoice').value;

            if (!text) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù†Øµ');
                return;
            }

            try {
                const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voiceId}`, {
                    method: 'POST',
                    headers: {
                        'Accept': 'audio/mpeg',
                        'Content-Type': 'application/json',
                        'xi-api-key': ELEVENLABS_KEY
                    },
                    body: JSON.stringify({
                        text: text,
                        model_id: 'eleven_monolingual_v1',
                        voice_settings: {
                            stability: 0.5,
                            similarity_boost: 0.5
                        }
                    })
                });

                if (!response.ok) throw new Error('ÙØ´Ù„ Ø§Ù„ØªÙˆÙ„ÙŠØ¯');

                const audioBlob = await response.blob();
                const audioUrl = URL.createObjectURL(audioBlob);
                
                // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØª
                const player = document.getElementById('ttsPlayer');
                const audio = document.getElementById('ttsAudio');
                audio.src = audioUrl;
                player.style.display = 'block';
                
                // Ø®ØµÙ… Ø§Ù„Ø±ØµÙŠØ¯
                currentUser.credits -= 10;
                
                // Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„
                currentUser.history.unshift({
                    type: 'tts',
                    text: text.substring(0, 30) + '...',
                    url: audioUrl,
                    date: new Date().toLocaleString()
                });
                
                saveUserData();
                
            } catch (error) {
                console.error('TTS Error:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØµÙˆØª');
            }
        }

        // Ø¯Ø¨Ù„Ø¬Ø© ÙÙŠØ¯ÙŠÙˆ
        async function startDubbing() {
            if (currentUser.plan === 'free') {
                alert('Ø§Ù„Ø¯Ø¨Ù„Ø¬Ø© Ù…ØªØ§Ø­Ø© ÙÙ‚Ø· ÙÙŠ Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©');
                showSection('plans');
                return;
            }

            const videoUrl = document.getElementById('videoUrl').value;
            if (!videoUrl) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ');
                return;
            }

            alert('Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ... Ø³ÙŠØªÙ… Ø¥Ø¹Ù„Ø§Ù…Ùƒ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡');
        }

        // ØªÙˆÙ„ÙŠØ¯ Ù…Ø¤Ø«Ø±Ø§Øª
        async function generateSFX() {
            if (currentUser.credits < 5) {
                alert('Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙ');
                return;
            }

            const prompt = document.getElementById('sfxPrompt').value;
            if (!prompt) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙˆØµÙ Ø§Ù„Ù…Ø¤Ø«Ø±');
                return;
            }

            // Ù…Ø­Ø§ÙƒØ§Ø© ØªÙˆÙ„ÙŠØ¯ Ù…Ø¤Ø«Ø± (Ù„Ø£Ù† AudioCraft Ù…Ø§ Ø²Ø§Ù„ ÙÙŠ beta)
            setTimeout(() => {
                const audioUrl = 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3';
                const player = document.getElementById('sfxPlayer');
                const audio = document.getElementById('sfxAudio');
                audio.src = audioUrl;
                player.style.display = 'block';
                
                currentUser.credits -= 5;
                saveUserData();
            }, 2000);
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„
        function loadHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            
            currentUser.history.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `
                    <div class="history-info">
                        <h4>${item.type === 'tts' ? 'ğŸ™ï¸' : 'ğŸ”Š'} ${item.text}</h4>
                        <p>${item.date}</p>
                    </div>
                    <button class="play-btn" onclick="playAudio('${item.url}')">â–¶ï¸</button>
                `;
                historyList.appendChild(div);
            });
        }

        function playAudio(url) {
            new Audio(url).play();
        }

        function selectPlan(plan) {
            alert(`Ø£Ù†Øª Ù…Ø´ØªØ±Ùƒ ÙÙŠ Ø§Ù„Ø®Ø·Ø© ${plan === 'free' ? 'Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©' : 'Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©'}`);
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
        const savedLang = localStorage.getItem('lang') || 'ar';
        changeLang(savedLang);
    </script>
</body>
</html>

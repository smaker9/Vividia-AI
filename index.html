<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vividia AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #050b18; --card: #111928; --accent: #4f46e5; --text: #f3f4f6; }
        body { font-family: 'Cairo', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; }
        
        /* الهيدر مع النجمة المتوهجة */
        header { padding: 15px 20px; background: var(--card); display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #1f2937; }
        .gemini-star { color: #8ab4f8; font-size: 1.5rem; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        #chat-container { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        
        .message { max-width: 85%; padding: 15px; border-radius: 18px; line-height: 1.6; position: relative; font-size: 0.95rem; }
        .user-message { align-self: flex-end; background: var(--accent); color: white; border-bottom-left-radius: 4px; }
        .ai-message { align-self: flex-start; background: var(--card); border: 1px solid #1f2937; border-bottom-right-radius: 4px; }

        /* أيقونة السماعة */
        .audio-icon { cursor: pointer; margin-right: 10px; color: #9ca3af; transition: 0.3s; }
        .audio-icon:hover { color: #8ab4f8; }

        /* منطقة الإدخال الاحترافية */
        .input-area { padding: 20px; background: var(--bg); border-top: 1px solid #1f2937; display: flex; align-items: center; gap: 12px; }
        input { flex: 1; background: #1f2937; border: 1px solid #374151; padding: 14px 20px; border-radius: 30px; color: white; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--accent); }
        button { background: var(--accent); color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
    <header>
        <i class="fas fa-sparkles gemini-star"></i>
        <strong>Vividia AI</strong>
    </header>

    <div id="chat-container">
        <div class="message ai-message">مرحباً بكِ! كيف يمكن لـ Vividia مساعدتكِ اليوم؟</div>
    </div>

    <div class="input-area">
        <input type="text" id="user-input" placeholder="اسألي Vividia أي شيء..." onkeypress="if(event.key === 'Enter') sendMessage()">
        <button onclick="sendMessage()">إرسال</button>
    </div>

    <script>
        async function sendMessage() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            if (!message) return;

            appendMessage('user', message);
            input.value = '';

            // إضافة رسالة فارغة لـ AI لبدء تأثير الكتابة
            const aiDiv = appendMessage('ai', '');
            
            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: message })
                });
                const data = await response.json();
                typeWriter(aiDiv, data.response);
            } catch (error) {
                aiDiv.innerText = "عذراً، تعذر الوصول للمحرك.";
            }
        }

        function appendMessage(role, text) {
            const container = document.getElementById('chat-container');
            const div = document.createElement('div');
            div.className = `message ${role === 'user' ? 'user-message' : 'ai-message'}`;
            
            if (role === 'ai') {
                const icon = document.createElement('i');
                icon.className = "fas fa-volume-up audio-icon";
                icon.onclick = () => speak(text);
                div.appendChild(icon);
                const span = document.createElement('span');
                span.innerText = text;
                div.appendChild(span);
            } else {
                div.innerText = text;
            }
            
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
            return role === 'ai' ? div.querySelector('span') : div;
        }

        // تأثير الكتابة (Streaming Effect)
        function typeWriter(element, text) {
            let i = 0;
            element.innerText = "";
            function type() {
                if (i < text.length) {
                    element.innerText += text.charAt(i);
                    i++;
                    setTimeout(type, 15); // سرعة الكتابة
                    document.getElementById('chat-container').scrollTop = document.getElementById('chat-container').scrollHeight;
                }
            }
            type();
        }

        // خاصية النطق الصوتي
        function speak(text) {
            const msg = new SpeechSynthesisUtterance();
            msg.text = text;
            msg.lang = 'ar-SA';
            window.speechSynthesis.speak(msg);
        }
    </script>
</body>
</html>
